# 착착(ChackChack) 기능 명세서

**Version**: 1.1  
**Date**: 2025-08-13  
**Platform**: React Native (모바일 앱) + NestJS (백엔드) + Web (손님용 페이지)

## 개요

착착(ChackChack)은 IT 기기 사용이 서툰 소상공인을 위한 **로그인 없는 첫 경험**을 제공하는 계좌이체 QR코드 생성 앱입니다.

### 핵심 가치
- **극도로 단순한 UX**: 복잡한 기능 배제, 직관적 인터페이스
- **로그인 없는 첫 경험**: 앱 설치 후 즉시 QR 생성 가능
- **로컬 우선**: 기기에 저장 후 선택적으로 클라우드 동기화

---

## 🎯 타겟 페르소나

### 1. 박복례 (60대 노점상)
- **특징**: 극도의 단순함 필요, 복잡한 기능 회피
- **니즈**: 한번 설정하면 계속 사용할 수 있는 QR코드

### 2. 최철민 (40대 대리기사) 
- **특징**: 속도와 효율성 중시, 여러 QR 관리
- **니즈**: 빠른 QR 생성 및 관리, 금액별 구분

### 3. 김아름 (20대 플리마켓 셀러)
- **특징**: 디자인과 브랜드 감성 중요
- **니즈**: 예쁜 QR코드, 소셜 공유 기능

---

## 📱 모바일 앱 (사장님용) 기능

### 📝 QR 생성/편집 화면 (CreateQRScreen) - v1.3 업데이트
**목적**: 최소한의 정보로 QR코드 생성 및 기존 QR 코드 편집

#### 필수 입력 정보
- **QR 이름**: 예) "카페 결제용", "택시비"
- **은행 선택**: 드롭다운 (10개 주요 은행)
- **계좌번호**: 숫자 입력
- **예금주명**: 텍스트 입력

#### 선택 입력 정보 (토글로 활성화)
- **기본 금액**: 원 단위
- **할인 설정**:
  - 퍼센트 할인 (%)
  - 금액 할인 (원)

#### UX 특징 (v1.3 개선)
- **포커스 상태 관리**: 활성 필드 시각적 구분
- **은행 선택 모달**: 빠른 선택 가능
- **실시간 유효성 검사**: 필수 정보 누락 시 알림
- **편집 모드**: 기존 QR 데이터로 모든 필드 자동 입력
- **독립적 토글**: 금액 지정과 할인 설정 개별 제어 가능
- **동적 제목**: 생성/편집 모드에 따라 화면 제목 변경

### ✅ QR 완료 화면 (QRCompleteScreen)
**목적**: 생성된 QR코드 확인 및 활용

#### 표시 정보
- **QR코드 이미지**: 250x250 크기
- **QR 정보**: 이름, 은행, 계좌번호, 예금주, 금액
- **생성 일시**

#### 기능 (사용자 상태별)

##### 게스트 사용자 (신규 생성 시)
- **QR 이미지 저장**: 기기에 로컬 저장
- **공유하기**: 소셜/메신저 공유
- **로그인하고 영구 보관**: 계정 연동 유도

##### 로그인 사용자 (신규 생성 시)
- **공유하기**: 소셜/메신저 공유  
- **내 QR코드 보기**: 목록으로 이동
- **새 QR 만들기**: 추가 생성

##### 기존 QR 조회 시
- **공유하기**: 소셜/메신저 공유
- **편집하기**: QR 편집 화면으로 이동
- **삭제하기**: 삭제 확인

### 📋 QR 목록 화면 (MyQRListScreen) - v1.2 업데이트 
**목적**: 앱의 메인 화면으로 QR코드 관리 및 생성 유도

#### 조건부 UI (v1.2 신규)

##### Empty State (QR코드 없는 경우) - 로그인 상태별 분기
- **제목**: "가장 쉬운 계좌이체 QR 만들기" (공통)
- **첫 번째 안내**: "아직 생성한 QR코드가 없습니다." (공통)
- **두 번째 안내** (상태별):
  - 게스트 사용자: "로그인 없이 즉시 시작하세요"
  - 로그인 사용자: "아래 버튼을 눌러 첫 QR코드를 만들어보세요."
- **메인 버튼**: "+ 첫 QR코드 만들기" (CreateQR 화면으로 이동, 공통)
- **디자인**: HomeScreen과 동일한 중앙 정렬 레이아웃

##### QR코드 목록 (QR코드 있는 경우)
- **QR 썸네일**: 80x80 미리보기
- **QR 이름**: 사용자 지정 이름
- **계좌 정보**: 은행명 | 계좌번호
- **금액 정보**: 설정된 경우만 표시

#### 기능
- **QR 클릭**: 상세보기 화면으로 이동
- **삭제 버튼**: 개별 삭제 (휴지통 아이콘) - 확인 모달 포함
- **새 QR 추가**: 우상단 "+ 새 QR" 버튼
- **더보기 메뉴**: 로그인 사용자만 표시 (⋮ 아이콘)
  - **로그아웃**: 확인 후 MyQRList 화면 새로고침
  - **계정 탈퇴**: 강력한 경고 메시지와 함께 계정 영구 삭제
- **데이터 구분**:
  - 로그인 사용자: 서버 데이터 (실시간 삭제 가능)
  - 게스트 사용자: 로컬 데이터

#### 경고 배너 (게스트 사용자)
- 로그인하지 않은 상태 안내
- "로그인하기" 링크 제공

### 🔐 로그인 화면 (LoginScreen)  
**목적**: 선택적 계정 연동

#### 소셜 로그인 옵션
- **카카오톡**: 카카오 계정 연동
- **네이버**: 네이버 계정 연동  
- **구글**: 구글 계정 연동

#### UX 특징
- **선택사항 강조**: "로그인은 선택사항입니다" 안내
- **게스트 계속 사용**: 로그인 없이 뒤로가기
- **자동 데이터 동기화**: 로그인 성공 시 로컬 QR 코드를 서버로 자동 병합
- **동기화 알림**: "로컬에 저장된 X개의 QR코드가 계정에 추가되었습니다" 안내
- **로컬 데이터 정리**: 동기화 완료 후 로컬 저장소에서 자동 삭제

### 🎬 스플래시 화면 (SplashScreen) - v1.2 업데이트
**목적**: 앱 로딩 및 초기 상태 확인

#### 기능
- **로고 애니메이션**: 브랜드 인식
- **인증 상태 확인**: 저장된 로그인 정보 검사
- **자동 네비게이션** (v1.2 변경):
  - 모든 경우 → MyQRListScreen (직접 이동)

---

## 🌐 웹 페이지 (손님용) 기능

### 💰 결제 페이지 (/payer.html)
**목적**: QR 스캔 후 송금 안내

#### URL 파라미터
- `qrId`: QR코드 고유 ID
- `bank`: 은행명
- `account`: 계좌번호  
- `holder`: 예금주명
- `amount`: 송금 금액 (선택)

#### 기능
1. **계좌 정보 표시**: 송금 대상 정보
2. **송금 앱 이동**: 은행별 딥링크 제공
3. **사장님께 알리기**: 결제 완료 알림 전송
   - 송금 앱 이동 후에만 활성화
   - 클릭 시 `/notify/:qrId` API 호출

#### UX v1.1 개선사항
- 송금 앱 이동 전까지 알림 버튼 비활성화
- 사용자 행동 유도를 통한 정확한 알림 타이밍

---

## 🔧 기술적 기능

### 🗄️ 데이터 저장 방식

#### 게스트 사용자
- **위치**: React Native AsyncStorage (로컬)
- **데이터**: QR코드 정보, 계좌 정보
- **특징**: 앱 삭제 시 데이터 삭제

#### 로그인 사용자  
- **위치**: PostgreSQL 데이터베이스 (서버)
- **동기화**: 실시간 서버 저장/조회
- **특징**: 다기기 동기화 가능

### 🔐 인증 시스템

#### JWT 토큰
- **게스트**: `authProvider: "guest"`
- **소셜 로그인**: `authProvider: "kakao|naver|google"`
- **만료**: 서버 설정에 따름

#### 상태 관리 (Zustand)
- 인증 상태 전역 관리
- AsyncStorage 자동 동기화

### 📊 QR코드 생성

#### 로컬 생성 (게스트)
- **라이브러리**: react-native-qrcode-svg
- **데이터**: 웹페이지 URL (payer.html)
- **저장**: base64 URL 문자열

#### 서버 생성 (로그인 사용자)
- **라이브러리**: qrcode (Node.js)
- **데이터**: 웹페이지 URL (payer.html)  
- **저장**: base64 PNG 이미지

---

## 📋 화면별 세부 명세

### 네비게이션 구조 (v1.2 업데이트)
```
App
├── SplashScreen (초기 로딩)
├── MyQRListScreen (메인 화면)
├── CreateQRScreen (QR 생성)
├── QRCompleteScreen (완료/상세)
└── LoginScreen (로그인)
```

### 상태 전환 (v1.2 업데이트)
```
SplashScreen
└── (모든 경우) → MyQRListScreen

MyQRListScreen
├── Empty State: "첫 QR코드 만들기" → CreateQRScreen
├── QR 클릭 → QRCompleteScreen
├── "+ 새 QR" → CreateQRScreen  
└── "로그인하기" → LoginScreen

CreateQRScreen
└── "QR 생성하기" → QRCompleteScreen

QRCompleteScreen  
├── "공유하기" → 시스템 공유
├── "내 QR코드 보기" → MyQRListScreen
├── "새 QR 만들기" → CreateQRScreen
└── "로그인하고 영구 보관" → LoginScreen

LoginScreen
└── 로그인 성공 → MyQRListScreen | 이전 화면
```

---

## ⚠️ 제약사항 및 고려사항

### 현재 미구현 기능
- 실제 푸시 알림 (FCM/APNS)
- QR코드 스타일링 (로고, 색상)
- 소셜 로그인 실제 연동

### 성능 고려사항
- QR코드 이미지 캐싱 필요
- 대용량 QR 목록 페이지네이션
- 네트워크 오류 시 로컬 fallback

### 보안 고려사항
- 계좌번호 마스킹 표시
- QR코드 URL 변조 방지
- 민감정보 로깅 금지

---

## 🚀 향후 개발 계획

### v1.1 계획
- 입금 알림 UX 개선 ✅
- 로고 디자인 개선  
- 손님용 페이지 UI/UX 개선

### v1.2 계획 ✅
- UX 개선: 독립적 토글 시스템
- 메인 화면 최적화
- 할인 정보 표시 개선

### v1.3 계획 ✅
- QR코드 편집 기능 완성
- PUT API 구현 및 통합
- 사용자 경험 완성도 향상

### v1.4 계획
- 결제 통계 대시보드
- 다중 계좌 관리
- QR코드 일괄 관리

---

## 변경 이력

### Version 1.3 (2025-08-13)
- **QR 코드 편집 기능 추가**: 사용자는 생성된 QR 코드의 이름, 계좌 정보, 지정 금액, 할인 등 모든 정보를 수정할 수 있습니다.
- **편집 UI/UX 완성**: CreateQRScreen이 편집 모드 진입 시 기존 데이터가 미리 채워져 있어 즉시 수정 가능
- **PUT /qrcodes/:id API 구현**: 백엔드에서 QR 코드 수정을 위한 RESTful API 완성
- **사용자 흐름 개선**: QRComplete → 편집하기 → CreateQR(편집모드) → QRComplete 자연스러운 흐름 구현

### Version 1.2 (2025-08-13)
- **초기 라우팅 구조 개선**: 스플래시 화면 → 첫 화면(홈) → 내 QR코드 목록에서 스플래시 화면 → 내 QR코드 목록으로 직접 변경
- **HomeScreen 제거**: 별도 첫 화면 제거로 불필요한 화면 단계 축소
- **MyQRListScreen Empty State 개선**: QR코드가 없을 때 HomeScreen과 동일한 "첫 QR코드 만들기" UI 표시
- **로그인 상태별 문구 분기**: Empty State에서 게스트/로그인 사용자에게 적합한 안내 문구 제공
- **사용자 경험(UX) 향상**: 앱 시작 후 더 빠른 핵심 기능 접근 가능
- **코드베이스 정리**: 사용하지 않는 HomeScreen 컴포넌트 및 관련 코드 삭제

### Version 1.1 (2025-08-13)
- **데이터 동기화 기능 추가**: 로그인 시 게스트 상태에서 생성한 로컬 QR 코드를 서버 계정에 자동 병합
- **계정 탈퇴 기능 추가**: '더보기(⋮)' 메뉴를 통한 계정 영구 삭제 기능
- **로그아웃 기능 추가**: '내 QR코드' 화면 더보기 메뉴(⋮)를 통한 로그아웃
- **QR 코드 삭제 기능 완성**: 서버 QR 코드 실시간 삭제 지원
- **UI/UX 개선**: 확인 모달을 통한 안전한 삭제 프로세스
- **소셜 로그인 구체화**: 카카오, 네이버, 구글 로그인만 지원 (자체 회원가입 제외)
- **스플래시 스크린 완성**: 로고 애니메이션 및 자동 네비게이션

### Version 1.0 (2025-08-13)
- 초기 기능 명세서 작성
- 모바일 앱 6개 화면 기능 정의
- 웹 페이지 손님용 기능 정의
- 데이터 저장 및 인증 시스템 명세